

```markdown
# ğŸš€ Platform Delivery â€“ Multi-Environment AKS, Terraform & GitOps Architektur

## ğŸ“Œ GesamtÃ¼berblick

Diese Plattform stellt eine vollstÃ¤ndig **automatisierte**, **sichere** und **erweiterbare** Azure Kubernetes Service (AKS)-Umgebung bereit. Sie kombiniert:

- **Terraform** fÃ¼r Infrastructure-as-Code  
- **ArgoCD** fÃ¼r GitOps  
- **Keycloak** fÃ¼r SSO  
- **Letâ€™s Encrypt** fÃ¼r TLS  
- **Prometheus, Grafana, Kyverno, Kubescape & Tetragon** fÃ¼r Monitoring & Security  

ğŸ¯ **Ziel:** Bereitstellung einer **standardisierten, mandantenfÃ¤higen** Cloud-Plattform fÃ¼r Endkunden â€“ von Infrastruktur bis Applikationsbetrieb.

**UnterstÃ¼tzte Environments:**  
- `dev` â€“ Development  
- `test` â€“ Testing  
- `prod` â€“ Production  

---

## ğŸ“ Repository-Struktur

| Ebene                  | Repository           | Aufgabe                                                            | Tooling                    |
|------------------------|----------------------|---------------------------------------------------------------------|----------------------------|
| Infrastructure-as-Code | `iac-client-cluster` | Azure Ressourcen, AKS, Vault, DNS, ArgoCD, cert-manager, Keycloak  | Terraform + GitHub Actions |
| GitOps Plattform       | `plattform-gitops`   | Helm-basierte App-Deployments (Monitoring, Security, Environments) | ArgoCD + Helm + Keycloak   |

### plattform-gitops Directory Structure

```
plattform-gitops/
â”œâ”€â”€ bootstrap/                      # ArgoCD App of Apps pattern
â”‚   â”œâ”€â”€ root-app.yaml              # Root application
â”‚   â”œâ”€â”€ appproject-platform.yaml   # Platform AppProject
â”‚   â”œâ”€â”€ appproject-applications.yaml
â”‚   â””â”€â”€ apps/                      # Application manifests
â”‚       â”œâ”€â”€ monitoring.yaml
â”‚       â”œâ”€â”€ security.yaml
â”‚       â””â”€â”€ ingress.yaml
â”œâ”€â”€ apps/                          # Application definitions
â”‚   â”œâ”€â”€ monitoring/                # Prometheus, Grafana, Loki
â”‚   â”œâ”€â”€ security/                  # Kyverno, Kubescape, Tetragon
â”‚   â”œâ”€â”€ ingress/                   # NGINX Ingress Controller
â”‚   â””â”€â”€ applications/              # Customer applications
â”œâ”€â”€ environments/                  # Environment-specific configs
â”‚   â”œâ”€â”€ dev/
â”‚   â”œâ”€â”€ test/
â”‚   â””â”€â”€ prod/
â”œâ”€â”€ .github/workflows/             # CI/CD automation
â”œâ”€â”€ STRUCTURE.md                   # Detailed structure docs
â””â”€â”€ GETTING-STARTED.md            # Quick start guide
```

ğŸ“– **See [STRUCTURE.md](./STRUCTURE.md) for detailed architecture and patterns**

---

## ğŸ—ï¸ ArchitekturÃ¼bersicht

```

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            iac-client-cluster (Terraform)     â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ Azure RG, ACR, Vault, DNS                   â”‚
â”‚ â€¢ AKS mit Cilium CNI                          â”‚
â”‚ â€¢ ArgoCD, Keycloak, cert-manager, Ingress     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            plattform-gitops (ArgoCD)          â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ Monitoring: Prometheus, Grafana, Loki       â”‚
â”‚ â€¢ Security: Kyverno, Kubescape, Tetragon      â”‚
â”‚ â€¢ cert-manager ClusterIssuer (Staging/Prod)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  AKS Cluster                  â”‚
â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚ â€¢ Cilium Networking, TLS, RBAC, Namespaces    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

---

## ğŸ§± Infrastruktur-Layer: `iac-client-cluster`

**Bereitgestellte Ressourcen:**

- Azure RG, DNS Zone, ACR, Vault, NSG  
- AKS (mit Cilium CNI)  
- NGINX Ingress Controller  
- cert-manager (Let's Encrypt)  
- Keycloak & ArgoCD  

---

## ğŸ” Bereitstellungsreihenfolge (kritisch)

| Schritt | Beschreibung                                     | Voraussetzung      |
|--------:|--------------------------------------------------|--------------------|
|       1 | Core-Ressourcen (RG, ACR, Vault, DNS, NSG)       | â€“                  |
|       2 | AKS-Deployment mit Cilium CNI                    | Core vorhanden     |
|       3 | Ingress-Controller                               | AKS bereit         |
|       4 | Ingress-LoadBalancer IP abwarten                 | Ingress lÃ¤uft      |
|       5 | DNS-EintrÃ¤ge fÃ¼r dev/test/prod + Tools erstellen | IP bekannt         |
|       6 | Installation cert-manager                        | DNS vorhanden      |
|       7 | TLS-Zertifikate (Letâ€™s Encrypt)                  | cert-manager aktiv |
|       8 | ArgoCD & Keycloak (TLS aktiviert)                | Zertifikate gÃ¼ltig |

âš ï¸ **Achtung:** DNS & TLS erst nach Ingress-IP!

---

## ğŸ” TLS & Domains (cert-manager + Letâ€™s Encrypt)

**Ziel:** Automatische TLS-Zertifikate fÃ¼r alle Umgebungen & Subdomains.

| Environment | ArgoCD                       | Keycloak                       | Grafana                       | Prometheus                       | Alertmanager                       |
|-------------|------------------------------|--------------------------------|-------------------------------|----------------------------------|------------------------------------|
| dev         | `argocd.dev.client-box.com`  | `keycloak.dev.client-box.com`  | `grafana.dev.client-box.com`  | `prometheus.dev.client-box.com`  | `alertmanager.dev.client-box.com`  |
| test        | `argocd.test.client-box.com` | `keycloak.test.client-box.com` | `grafana.test.client-box.com` | `prometheus.test.client-box.com` | `alertmanager.test.client-box.com` |
| prod        | `argocd.prod.client-box.com` | `keycloak.prod.client-box.com` | `grafana.prod.client-box.com` | `prometheus.prod.client-box.com` | `alertmanager.prod.client-box.com` |

---

## âš™ï¸ GitOps Layer: `plattform-gitops`

**Aufgaben:**

- ArgoCD-Bootstrap & Helm-basierte App-Verwaltung  
- Automatische Environment-Trennung & Synchronisierung  

**Stacks:**

| Kategorie    | Komponenten                                                             |
|--------------|-------------------------------------------------------------------------|
| Monitoring   | Prometheus, Grafana, Loki, Alertmanager (mit Teams Webhook)             |
| Security     | Kyverno (Policies), Kubescape (Compliance), Tetragon (Runtime Security) |
| Automation   | cert-manager ClusterIssuer (Staging/Prod)                               |
| Environments | ArgoCD-Projekte & Namespaces fÃ¼r dev/test/prod                          |

---

## ğŸ“Š Monitoring Stack

- Vollautomatische TLS  
- Alerts Ã¼ber Microsoft Teams (via Alertmanager)  
- Keycloak-SSO fÃ¼r Grafana-Zugriff  

**Zugriffs-URLs:**

```

Grafana:      grafana.<env>.client-box.com
Prometheus:   prometheus.<env>.client-box.com
Alertmanager: alertmanager.<env>.client-box.com

```

---

## ğŸ›¡ï¸ Security Stack

- **Kyverno**: Policy-Enforcement  
- **Kubescape**: CIS/NSA/MITRE-konforme Scans  
- **Tetragon**: Runtime-Sicherheit  

Alle Ã¼ber GitOps verwaltet. Ergebnisse in **Grafana** visualisiert.

---

## ğŸ” Kubescape Integration â€“ Security Observability

- Scanergebnisse als **Prometheus-Metriken**  
- Visualisierung in **dedizierten Dashboards**  
- Alertmanager meldet Findings an **Microsoft Teams**  

---

## ğŸ§‘â€ğŸ’¼ Identity & RBAC mit Keycloak

| Rolle | Beschreibung             | Zugriff                    |
|-------|--------------------------|----------------------------|
| admin | Plattform-Admins / SRE   | Alle Environments & Stacks |
| dev   | Kundenteams / Entwickler | Nur eigenes ArgoCD-Projekt |

- Zentrale SSO-Integration (Keycloak OIDC)  
- ArgoCD & Grafana nutzen OIDC-Tokens zur Rollenvergabe  

---

## ğŸ” Sicherheit & Governance

- Secrets im Azure Key Vault  
- GitHub OIDC fÃ¼r Terraform (keine Secrets im Repo)  
- RBAC & Isolation Ã¼ber Namespaces und ArgoCD Projects  
- Policy & Compliance: Kyverno, Kubescape  

---

## ğŸŒ Zugriffspunkte

| Komponente   | URL Pattern                                |
|--------------|---------------------------------------------|
| ArgoCD       | `https://argocd.<env>.client-box.com`       |
| Keycloak     | `https://keycloak.<env>.client-box.com`     |
| Grafana      | `https://grafana.<env>.client-box.com`      |
| Prometheus   | `https://prometheus.<env>.client-box.com`   |
| Alertmanager | `https://alertmanager.<env>.client-box.com` |

Alle Endpunkte via **Letâ€™s Encrypt** abgesichert.

---

## ğŸ”„ Pipeline Flow

| Phase               | Tool      | Beschreibung                                |
|---------------------|-----------|---------------------------------------------|
| Infrastrukturaufbau | Terraform | Provisioniert AKS, Vault, DNS, cert-manager |
| Ingress-IP-Abfrage  | Terraform | Wartet auf LoadBalancer-IP                  |
| DNS & Zertifikate   | Terraform | Erstellt DNS-Records & TLS-Zertifikate      |
| ArgoCD Bootstrap    | Terraform | Verbindet ArgoCD mit GitOps-Repo            |
| GitOps Sync         | ArgoCD    | Deployt Monitoring, Security, Environments  |
| RBAC                | Keycloak  | Steuert den Zugriff Ã¼ber Rollen             |

---

## ğŸ Endzustand

âœ… MandantenfÃ¤hige, mehrstufige AKS-Plattform  
âœ… Automatisierte Bereitstellung (Infra + App)  
âœ… Zertifikats-Management via Letâ€™s Encrypt  
âœ… Monitoring & Security integriert  
âœ… GitOps-zentrierte Verwaltung (ArgoCD)  
âœ… Keycloak-basiertes SSO & RBAC  

---

## ğŸ§  Vorteile

- ğŸ’¡ **VollstÃ¤ndig automatisiert** â€“ von Terraform bis ArgoCD  
- ğŸ”’ **Security & Observability by Design**  
- ğŸŒ **Multi-Environment DNS & TLS out-of-the-box**  
- ğŸ‘¥ **Zentrale SSO- & RBAC-LÃ¶sung**  
- ğŸ“ˆ **Auditierbar, skalierbar, produktionsreif**  
